{% extends "Admin/edit.html.twig" %}

{# override javascript includes #}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
    <script src="{{ path('fos_js_routing_js', {callback: 'fos.Router.setData'}) }}"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            let workOrderNode = jQuery('#{{ form.workOrder.vars.id }}');
            workOrderNode.change(function(event) {
                let workOrderId = event.val;
                updateWindfarmNodeBySelectedWorkOrderId(workOrderId);
            });
            {% if admin.id(object) %}
                {# edit mode #}
                {% if object.nonStandardUsedMaterials | length > 0 %}
                    let bnsum = jQuery('#field_widget_{{ form.workOrderTasks.vars.id }}')[0].children[0].children[0].children[0];
                    bnsum.children[0].width = '5%';
                    bnsum.children[2].width = '5%';
                {% endif %}
            {% endif %}
        });
        function updateWindfarmNodeBySelectedWorkOrderId(workOrderId) {
            let windfarmNode = jQuery('#{{ form.windfarm.vars.id }}');
            jQuery.get(Routing.generate('admin_app_workorder_getWindfarmsFromCustomerId', {id: workOrderId})).done(function (response) {
                let jsonResponse = jQuery.parseJSON(response);
                windfarmNode.empty().html(jsonResponse.htmlOptionStringData);
                windfarmNode.select2('val', '');
            });
        }
        function updateWindmillNodeBySelectedWindfarmId(selectedWindfarmId) {
            jQuery.post(Routing.generate('admin_app_workorder_getWindmillsFromSelectedWindfarmsIds', selectedWindfarmsIds)).done(function (response) {
                let jsonResponse = jQuery.parseJSON(response);
                windmillNode.empty().html(jsonResponse.htmlOptionStringData);
            });
        }
    </script>
{% endblock %}
